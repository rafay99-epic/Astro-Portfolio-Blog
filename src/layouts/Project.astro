---
import BaseHead from "@astro/base/BaseHead.astro";
import Header from "@astro/header/Header.astro";
import Footer from "@astro/footer/Footer.astro";
import ShareButtons from "@react/blog/interactions/socialButton";
import { featureFlags } from "@config/featureFlag/featureFlag.json";
import MermaidRenderer from "@react/blog/enhancements/diagram-renderer/MermaidRenderer";
import CodeCopySimple from "@react/blog/enhancements/code-copy/CodeCopySimple";

const pageUrl = Astro.url.href;
export const prerender = true;

type Props = {
  Projecttitle: string;
  ProjectDescription: string;
  ProjectTech?: string[];
  ProjectImage?: string;
  ProjectGithubLink?: string;
  ProjectDeployedLink?: string;
  ProjectCategory?: string[];
  ProjectRanking?: string;
};

const {
  Projecttitle,
  ProjectDescription,
  ProjectTech,
  ProjectImage,
  ProjectGithubLink,
  ProjectDeployedLink,
  ProjectCategory,
  ProjectRanking,
} = Astro.props as Props;

const primaryCategory = ProjectCategory?.[0];
const stackCount = ProjectTech?.length ?? 0;

try {
  if (!featureFlags.showProjects) {
    return Astro.redirect("/access-denied");
  }
} catch (error) {
  return Astro.redirect("/404");
}
---

<html lang="en">
  <head>
    <BaseHead title={Projecttitle} description={ProjectDescription} />
    <style>
      html {
        background-color: var(--color-bg-primary);
      }

      body {
        background-color: var(--color-bg-primary);
      }

      .project-container {
        min-height: 100vh;
        background-color: var(--color-bg-primary);
        color: var(--color-text-primary);
      }

      .project-shell {
        margin: 0;
        padding: 0;
        max-width: 100%;
      }

      .project-hero {
        padding: clamp(3rem, 6vw, 5.5rem) 1.5rem 2.5rem;
        border-bottom: 1px solid var(--color-border-secondary);
      }

      .project-hero__inner {
        max-width: 1180px;
        margin: 0 auto;
        display: grid;
        gap: 2.25rem;
        align-items: center;
      }

      .project-hero__inner.has-media {
        grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
      }

      .project-hero__copy {
        display: grid;
        gap: 1.25rem;
      }

      .project-badges {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .project-pill {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        padding: 0.35rem 0.65rem;
        border-radius: 999px;
        border: 1px solid var(--color-border-secondary);
        background: rgba(36, 40, 59, 0.6);
        color: var(--color-text-secondary);
      }

      .project-pill--rank {
        border-color: var(--color-border-hover);
        color: var(--color-text-primary);
      }

      .project-title {
        margin: 0;
        font-size: clamp(2.2rem, 4.1vw, 3.7rem);
        line-height: 1.05;
        font-weight: 700;
      }

      .project-description {
        margin: 0;
        max-width: 42rem;
        font-size: clamp(1rem, 1.7vw, 1.15rem);
        color: var(--color-text-secondary);
        line-height: 1.6;
      }

      .project-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
      }

      .project-action {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.65rem 1.2rem;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 600;
        text-decoration: none;
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease,
          background 0.3s ease,
          color 0.3s ease,
          border-color 0.3s ease;
      }

      .project-action svg {
        width: 16px;
        height: 16px;
      }

      .project-action--primary {
        background: var(--color-primary);
        color: #ffffff;
        box-shadow: 0 10px 22px rgba(122, 162, 247, 0.25);
      }

      .project-action--primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 16px 28px rgba(122, 162, 247, 0.35);
      }

      .project-action--ghost {
        border: 1px solid var(--color-border-hover);
        color: var(--color-text-primary);
        background: rgba(122, 162, 247, 0.1);
      }

      .project-action--ghost:hover {
        transform: translateY(-1px);
        background: rgba(122, 162, 247, 0.2);
      }

      .project-meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.75rem;
      }

      .project-meta__item {
        padding: 0.75rem 0.95rem;
        border-radius: 12px;
        border: 1px solid var(--color-border-secondary);
        background: var(--color-bg-secondary);
      }

      .project-meta__label {
        display: block;
        font-size: 0.65rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--color-text-muted);
      }

      .project-meta__value {
        display: block;
        margin-top: 0.35rem;
        font-size: 1rem;
        font-weight: 600;
        color: var(--color-text-primary);
      }

      .project-hero__media {
        border-radius: 18px;
        overflow: hidden;
        border: 1px solid var(--color-border-secondary);
        background: var(--color-bg-secondary);
        box-shadow: 0 18px 40px rgba(10, 12, 20, 0.35);
      }

      .project-hero__media img {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
        aspect-ratio: 4 / 3;
        transition: transform 0.5s ease;
      }

      .project-hero__media:hover img {
        transform: scale(1.02);
      }

      .project-body {
        padding: clamp(2.5rem, 5vw, 4.5rem) 1.5rem 5rem;
      }

      .project-body__inner {
        max-width: 1180px;
        margin: 0 auto;
        display: grid;
        gap: 2rem;
      }

      .project-article {
        min-width: 0;
        display: grid;
        gap: 1.75rem;
      }

      .project-content {
        border-radius: 18px;
        border: 1px solid var(--color-border-secondary);
        background: var(--color-bg-secondary);
        padding: clamp(1.6rem, 3vw, 2.6rem);
        line-height: 1.7;
        font-size: 1.05rem;
      }

      .project-content h1,
      .project-content h2,
      .project-content h3,
      .project-content h4,
      .project-content h5,
      .project-content h6 {
        margin-top: 2.25rem;
        margin-bottom: 0.75rem;
        scroll-margin-top: 120px;
      }

      .project-content h2 {
        font-size: 1.8rem;
        padding-left: 0.9rem;
        border-left: 3px solid var(--color-border-hover);
        color: var(--color-text-primary);
      }

      .project-content h3 {
        font-size: 1.4rem;
        color: var(--color-text-primary);
      }

      .project-content p {
        margin: 0 0 1.2rem;
        color: var(--color-text-secondary);
      }

      .project-content a {
        color: var(--color-text-accent);
      }

      .project-content blockquote {
        margin: 1.5rem 0;
        padding: 1rem 1.4rem;
        border-left: 3px solid var(--color-border-hover);
        background: rgba(122, 162, 247, 0.08);
        border-radius: 8px;
        color: var(--color-text-secondary);
      }

      .project-content pre {
        background: var(--color-bg-tertiary);
        border-radius: 12px;
        padding: 1rem 1.25rem;
        overflow-x: auto;
      }

      .project-content ul li::marker {
        color: var(--color-text-accent);
      }

      .project-content ol li::marker {
        color: var(--color-secondary);
        font-weight: 600;
      }

      .project-share {
        display: flex;
        justify-content: flex-start;
      }

      .project-aside {
        display: grid;
        gap: 1.25rem;
        align-self: start;
      }

      .project-card {
        border-radius: 16px;
        border: 1px solid var(--color-border-secondary);
        background: rgba(36, 40, 59, 0.7);
        padding: 1.25rem;
      }

      .project-card h3 {
        margin: 0 0 0.9rem;
        font-size: 1rem;
        color: var(--color-text-primary);
      }

      .project-summary-grid {
        display: grid;
        gap: 0.85rem;
      }

      .project-summary-item {
        display: grid;
        gap: 0.2rem;
      }

      .project-summary-label {
        font-size: 0.65rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--color-text-muted);
      }

      .project-summary-value {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--color-text-primary);
      }

      .project-summary-links {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
        margin-top: 0.4rem;
      }

      .project-summary-link {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.4rem 0.7rem;
        border-radius: 999px;
        border: 1px solid var(--color-border-secondary);
        font-size: 0.75rem;
        text-decoration: none;
        color: var(--color-text-secondary);
        transition:
          border-color 0.3s ease,
          color 0.3s ease,
          background 0.3s ease;
      }

      .project-summary-link:hover {
        border-color: var(--color-border-hover);
        color: var(--color-text-primary);
        background: rgba(122, 162, 247, 0.12);
      }

      .project-tech {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .project-tech__chip {
        padding: 0.35rem 0.7rem;
        font-size: 0.7rem;
        border-radius: 999px;
        border: 1px solid var(--color-border-secondary);
        background: rgba(26, 27, 38, 0.7);
        color: var(--color-text-secondary);
      }

      .project-toc {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .project-toc a {
        text-decoration: none;
        color: var(--color-text-secondary);
        font-size: 0.85rem;
        padding: 0.4rem 0.6rem;
        border-radius: 8px;
        border: 1px solid transparent;
        transition:
          color 0.3s ease,
          border-color 0.3s ease,
          background 0.3s ease;
      }

      .project-toc a[data-level="h3"] {
        padding-left: 1.1rem;
        font-size: 0.8rem;
      }

      .project-toc a[data-active="true"] {
        color: var(--color-text-primary);
        border-color: var(--color-border-hover);
        background: rgba(122, 162, 247, 0.12);
      }

      @media (min-width: 1024px) {
        .project-body__inner {
          grid-template-columns: minmax(0, 1fr) 300px;
        }

        .project-aside {
          position: sticky;
          top: 1.5rem;
        }
      }

      @media (max-width: 900px) {
        .project-hero__inner.has-media {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 720px) {
        .project-actions {
          flex-direction: column;
          align-items: flex-start;
        }

        .project-share {
          justify-content: center;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .project-hero__media img {
          transition: none;
        }
      }
    </style>
  </head>

  <body class="project-container" style="overflow-x: hidden; overflow-y: auto;">
    <Header />

    <main class="project-shell">
      <section class="project-hero">
        <div class={`project-hero__inner ${ProjectImage ? "has-media" : ""}`}>
          <div class="project-hero__copy">
            <div class="project-badges">
              {
                primaryCategory && (
                  <span class="project-pill">{primaryCategory}</span>
                )
              }
              {
                ProjectRanking && (
                  <span class="project-pill project-pill--rank">
                    Rank #{ProjectRanking}
                  </span>
                )
              }
            </div>

            <h1
              class="project-title"
              transition:name={`project-title-${Projecttitle}`}
            >
              {Projecttitle}
            </h1>

            {
              ProjectDescription && (
                <p class="project-description">{ProjectDescription}</p>
              )
            }

            {
              (ProjectDeployedLink || ProjectGithubLink) && (
                <div class="project-actions">
                  {ProjectDeployedLink && (
                    <a
                      href={ProjectDeployedLink}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="project-action project-action--primary"
                    >
                      Live Preview
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        aria-hidden="true"
                      >
                        <path d="M7 17 17 7" />
                        <path d="M8 7h9v9" />
                      </svg>
                    </a>
                  )}
                  {ProjectGithubLink && (
                    <a
                      href={ProjectGithubLink}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="project-action project-action--ghost"
                    >
                      Source Code
                      <svg
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        aria-hidden="true"
                      >
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                      </svg>
                    </a>
                  )}
                </div>
              )
            }

            <div class="project-meta">
              <div class="project-meta__item">
                <span class="project-meta__label">Category</span>
                <span class="project-meta__value">
                  {primaryCategory ?? "General"}
                </span>
              </div>
              <div class="project-meta__item">
                <span class="project-meta__label">Rank</span>
                <span class="project-meta__value">
                  {ProjectRanking ?? "—"}
                </span>
              </div>
              <div class="project-meta__item">
                <span class="project-meta__label">Stack Size</span>
                <span class="project-meta__value">
                  {stackCount ? `${stackCount} tools` : "—"}
                </span>
              </div>
            </div>
          </div>

          {
            ProjectImage && (
              <div class="project-hero__media">
                <img src={ProjectImage} alt={Projecttitle} loading="eager" />
              </div>
            )
          }
        </div>
      </section>

      <section class="project-body">
        <div class="project-body__inner">
          <div class="project-article">
            <div class="project-content" id="project-content">
              <slot />
            </div>

            <div class="project-share">
              <ShareButtons url={pageUrl} pagetitle="Project" client:visible />
            </div>
          </div>

          <aside class="project-aside">
            <div class="project-card">
              <h3>Project Snapshot</h3>
              <div class="project-summary-grid">
                <div class="project-summary-item">
                  <span class="project-summary-label">Category</span>
                  <span class="project-summary-value">
                    {primaryCategory ?? "General"}
                  </span>
                </div>
                <div class="project-summary-item">
                  <span class="project-summary-label">Rank</span>
                  <span class="project-summary-value">
                    {ProjectRanking ?? "—"}
                  </span>
                </div>
                <div class="project-summary-item">
                  <span class="project-summary-label">Stack</span>
                  <span class="project-summary-value">
                    {stackCount ? `${stackCount} tools` : "—"}
                  </span>
                </div>
                {
                  (ProjectDeployedLink || ProjectGithubLink) && (
                    <div class="project-summary-item">
                      <span class="project-summary-label">Links</span>
                      <div class="project-summary-links">
                        {ProjectDeployedLink && (
                          <a
                            href={ProjectDeployedLink}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="project-summary-link"
                          >
                            Live
                          </a>
                        )}
                        {ProjectGithubLink && (
                          <a
                            href={ProjectGithubLink}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="project-summary-link"
                          >
                            Source
                          </a>
                        )}
                      </div>
                    </div>
                  )
                }
              </div>
            </div>

            {
              ProjectTech && ProjectTech.length > 0 && (
                <div class="project-card">
                  <h3>Tech Stack</h3>
                  <div class="project-tech">
                    {ProjectTech.map((tech) => (
                      <span class="project-tech__chip">{tech}</span>
                    ))}
                  </div>
                </div>
              )
            }

            <div class="project-card project-card--toc">
              <h3>On this page</h3>
              <nav class="project-toc" id="project-toc"></nav>
            </div>
          </aside>
        </div>
      </section>
    </main>

    <MermaidRenderer client:load />
    <CodeCopySimple client:visible />

    <script is:inline>
      const content = document.getElementById("project-content");
      const toc = document.getElementById("project-toc");
      const tocCard = document.querySelector(".project-card--toc");

      if (content && toc) {
        const headings = Array.from(content.querySelectorAll("h2, h3"));
        const slugCounts = new Map();

        const slugify = (text) => {
          return text
            .toLowerCase()
            .trim()
            .replace(/[^a-z0-9]+/g, "-")
            .replace(/(^-|-$)/g, "");
        };

        headings.forEach((heading, index) => {
          if (!heading.id) {
            let slug = slugify(heading.textContent || "section");
            if (!slug) {
              slug = `section-${index + 1}`;
            }
            const count = slugCounts.get(slug) || 0;
            slugCounts.set(slug, count + 1);
            if (count > 0) {
              slug = `${slug}-${count + 1}`;
            }
            heading.id = slug;
          }

          const link = document.createElement("a");
          link.href = `#${heading.id}`;
          link.textContent = heading.textContent || "";
          link.dataset.level = heading.tagName.toLowerCase();
          toc.appendChild(link);
        });

        if (!headings.length && tocCard) {
          tocCard.style.display = "none";
        }

        const links = Array.from(toc.querySelectorAll("a"));

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (!entry.isIntersecting) return;
              const id = entry.target.id;
              links.forEach((link) => {
                link.dataset.active =
                  link.getAttribute("href") === `#${id}` ? "true" : "false";
              });
            });
          },
          {
            rootMargin: "-20% 0px -70% 0px",
            threshold: 0.1,
          },
        );

        headings.forEach((heading) => observer.observe(heading));
      }

      if ("scrollRestoration" in history) {
        history.scrollRestoration = "manual";
      }

      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          window.scrollTo(0, 0);
        }, 0);
      });
    </script>

    <Footer />
  </body>
</html>
