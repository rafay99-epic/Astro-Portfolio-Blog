---
import experienceData from "@config/siteConfig/info.json";
import { Icon } from "astro-icon/components";

const workExperience = experienceData.workExperience;

const totalPositions = workExperience.length;
const totalTechnologies = new Set(
	workExperience.flatMap((job) => job.toolsUsed),
).size;
const totalResponsibilities = workExperience.reduce(
	(total, job) => total + job.roles.length,
	0,
);
---

<style>
  /* Timeline animations */
  .timeline-item {
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.6s ease-out forwards;
  }

  .timeline-item:nth-child(1) {
    animation-delay: 0.1s;
  }
  .timeline-item:nth-child(2) {
    animation-delay: 0.2s;
  }
  .timeline-item:nth-child(3) {
    animation-delay: 0.3s;
  }
  .timeline-item:nth-child(4) {
    animation-delay: 0.4s;
  }
  .timeline-item:nth-child(5) {
    animation-delay: 0.5s;
  }
  .timeline-item:nth-child(6) {
    animation-delay: 0.6s;
  }

  @keyframes fadeInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Header animation */
  .header-animate {
    opacity: 0;
    transform: translateY(-20px);
    animation: headerFadeIn 0.8s ease-out forwards;
  }

  @keyframes headerFadeIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Stats animation */
  .stats-animate {
    opacity: 0;
    transform: translateY(20px);
    animation: statsFadeIn 0.8s ease-out 0.5s forwards;
  }

  @keyframes statsFadeIn {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Card hover effects */
  .experience-card {
    transition: all 0.3s ease-out;
  }

  .experience-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 20px 40px rgba(122, 162, 247, 0.1);
  }

  /* Timeline dot glow effect */
  .timeline-dot {
    box-shadow: 0 0 15px rgba(122, 162, 247, 0.5);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      box-shadow: 0 0 15px rgba(122, 162, 247, 0.5);
    }
    50% {
      box-shadow: 0 0 25px rgba(122, 162, 247, 0.8);
    }
  }

  /* Bottom accent line animation */
  .accent-line {
    width: 0;
    transition: width 0.5s ease-out;
  }

  .experience-card:hover .accent-line {
    width: 100%;
  }

  /* Technology tag hover */
  .tech-tag {
    transition: all 0.2s ease-out;
  }

  .tech-tag:hover {
    transform: scale(1.05);
    background-color: rgba(122, 162, 247, 0.2) !important;
  }

  /* Responsive timeline */
  @media (max-width: 768px) {
    .timeline-line {
      left: 1rem;
    }

    .timeline-dot {
      left: 0.625rem;
    }

    .timeline-item {
      padding-left: 3rem;
    }
  }

  @media (min-width: 769px) {
    .timeline-line {
      left: 50%;
      transform: translateX(-50%);
    }

    .timeline-dot {
      left: 50%;
      transform: translateX(-50%);
    }

    .timeline-item:nth-child(odd) {
      flex-direction: row;
    }

    .timeline-item:nth-child(even) {
      flex-direction: row-reverse;
    }
  }
</style>

<section class="relative px-4 py-8">
  <div class="absolute inset-0 overflow-hidden opacity-15">
    <div
      class="absolute left-1/4 top-1/4 h-64 w-64 rounded-full blur-3xl"
      style="background-color: #7aa2f7;"
    >
    </div>
    <div
      class="absolute bottom-1/4 right-1/4 h-56 w-56 rounded-full blur-3xl"
      style="background-color: #bb9af7;"
    >
    </div>
  </div>

  <div class="container relative z-10 mx-auto max-w-7xl">
    <div class="header-animate mb-8 text-center">
      <h2
        class="mb-4 flex items-center justify-center gap-3 text-2xl font-bold md:text-4xl lg:text-5xl"
        style="background: linear-gradient(135deg, #7aa2f7, #bb9af7, #9ece6a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;"
      >
        <Icon
          name="lucide:briefcase"
          class="h-8 w-8 md:h-12 md:w-12"
          style="color: #7aa2f7;"
        />
        <span>Professional Experience</span>
      </h2>
      <p class="mx-auto max-w-2xl text-sm md:text-lg" style="color: #a9b1d6;">
        My journey through various roles and technologies in software
        development
      </p>
    </div>

    <div class="relative">
      <div
        class="timeline-line absolute h-full w-0.5 opacity-30"
        style="background: linear-gradient(to bottom, #7aa2f7, #bb9af7, #9ece6a);"
      >
      </div>

      {
        workExperience.map((job, index) => (
          <div
            class={`timeline-item relative mb-12 flex items-center ${
              index % 2 === 0 ? "flex-row" : "flex-row-reverse"
            }`}
          >
            <div
              class="timeline-dot absolute z-20 h-4 w-4 rounded-full shadow-lg"
              style="background: linear-gradient(135deg, #7aa2f7, #bb9af7);"
            />

            <div
              class={`absolute top-1/2 z-10 h-0.5 w-8 -translate-y-0.5 transform ${
                index % 2 === 0 ? "left-1/2 ml-2" : "right-1/2 mr-2"
              }`}
              style={`background: linear-gradient(${
                index % 2 === 0 ? "to right" : "to left"
              }, #7aa2f7, #bb9af7);`}
            />

            <div class={`w-full md:w-[calc(50%-3rem)]`}>
              <div
                class="experience-card group relative rounded-xl border p-6 shadow-lg backdrop-blur-sm transition-all duration-300 hover:shadow-xl"
                style="background-color: rgba(45, 49, 66, 0.6); border-color: rgba(86, 95, 137, 0.4);"
              >
                <div
                  class="absolute right-0 top-0 h-20 w-20 rounded-bl-3xl rounded-tr-xl opacity-20"
                  style="background: linear-gradient(to bottom left, #7aa2f7, transparent);"
                />

                <div class="relative z-10 mb-4">
                  <div class="mb-3 flex items-start gap-3">
                    <div
                      class="flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-lg transition-transform duration-300 group-hover:scale-110"
                      style="background: linear-gradient(135deg, #7aa2f7, #bb9af7);"
                    >
                      <Icon
                        name="lucide:building-2"
                        class="h-6 w-6 text-white"
                      />
                    </div>
                    <div class="min-w-0 flex-1">
                      <h3
                        class="text-lg font-bold leading-tight"
                        style="color: #c0caf5;"
                      >
                        {job.position}
                      </h3>
                      <p
                        class="text-base font-semibold"
                        style="color: #bb9af7;"
                      >
                        @ {job.companyName}
                      </p>
                    </div>
                  </div>

                  <div class="flex items-center gap-2 text-xs">
                    <Icon
                      name="lucide:calendar"
                      class="h-3 w-3"
                      style="color: #9ece6a;"
                    />
                    <span style="color: #a9b1d6;">{job.employmentTime}</span>
                  </div>
                </div>

                <div class="relative z-10 mb-4">
                  <h4
                    class="mb-2 flex items-center gap-2 text-sm font-semibold"
                    style="color: #c0caf5;"
                  >
                    <Icon
                      name="lucide:clipboard-list"
                      class="h-4 w-4"
                      style="color: #7aa2f7;"
                    />
                    Key Responsibilities
                  </h4>
                  <ul class="space-y-1">
                    {job.roles.slice(0, 3).map((role) => (
                      <li
                        class="flex items-start gap-2 text-xs leading-relaxed"
                        style="color: #a9b1d6;"
                      >
                        <span class="mt-0.5 text-xs" style="color: #9ece6a;">
                          â–¸
                        </span>
                        <span>{role}</span>
                      </li>
                    ))}
                  </ul>
                </div>

                <div class="relative z-10">
                  <h4
                    class="mb-2 flex items-center gap-2 text-sm font-semibold"
                    style="color: #c0caf5;"
                  >
                    <Icon
                      name="lucide:code-2"
                      class="h-4 w-4"
                      style="color: #bb9af7;"
                    />
                    Technologies
                  </h4>
                  <div class="flex flex-wrap gap-1">
                    {job.toolsUsed.slice(0, 6).map((tech) => (
                      <span
                        class="tech-tag rounded border px-2 py-1 text-xs"
                        style="background-color: rgba(26, 27, 38, 0.6); border-color: rgba(86, 95, 137, 0.4); color: #7aa2f7;"
                      >
                        {tech}
                      </span>
                    ))}
                    {job.toolsUsed.length > 6 && (
                      <span
                        class="rounded border px-2 py-1 text-xs"
                        style="background-color: rgba(36, 40, 59, 0.6); border-color: rgba(86, 95, 137, 0.4); color: #565f89;"
                      >
                        +{job.toolsUsed.length - 6}
                      </span>
                    )}
                  </div>
                </div>

                <div
                  class="accent-line absolute bottom-0 left-0 h-0.5 rounded-b-xl"
                  style="background: linear-gradient(90deg, #7aa2f7, #bb9af7);"
                />
              </div>
            </div>
          </div>
        ))
      }
    </div>

    <div class="stats-animate mt-12">
      <div
        class="rounded-xl border p-6 backdrop-blur-sm"
        style="background-color: rgba(45, 49, 66, 0.4); border-color: rgba(86, 95, 137, 0.3);"
      >
        <div class="grid grid-cols-1 gap-6 text-center md:grid-cols-3">
          <div>
            <div
              class="mb-1 text-xl font-bold md:text-3xl"
              style="color: #7aa2f7;"
            >
              {totalPositions}
            </div>
            <div class="text-xs md:text-base" style="color: #a9b1d6;">
              Positions
            </div>
          </div>
          <div
            class="md:border-l md:border-r"
            style="border-color: rgba(86, 95, 137, 0.3);"
          >
            <div
              class="mb-1 text-xl font-bold md:text-3xl"
              style="color: #bb9af7;"
            >
              {totalTechnologies}
            </div>
            <div class="text-xs md:text-base" style="color: #a9b1d6;">
              Technologies
            </div>
          </div>
          <div>
            <div
              class="mb-1 text-xl font-bold md:text-3xl"
              style="color: #9ece6a;"
            >
              {totalResponsibilities}
            </div>
            <div class="text-xs md:text-base" style="color: #a9b1d6;">
              Responsibilities
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
