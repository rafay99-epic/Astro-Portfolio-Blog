---
import type { Post } from "types/articles";

const { allTags, paginatedPosts, selectedTag, currentPage, totalPages } =
  Astro.props;

const getTagUrl = (tag: string | null) => {
  if (tag) {
    return `/tag/${tag}`;
  }
  return "/tag";
};

const getPageUrl = (page: number) => {
  if (selectedTag) {
    if (page === 1) {
      return `/tag/${selectedTag}`;
    }
    return `/tag/${selectedTag}/page/${page}`;
  }
  if (page === 1) {
    return "/tag";
  }
  return `/tag/page/${page}`;
};
---

<style>
  /* Basic transitions for hover effects, replacing Framer Motion where simple */
  .transition-colors {
    transition-property: background-color, border-color, color, fill, stroke;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 300ms;
  }
  .transition-transform {
    transition-property: transform;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 300ms;
  }
  .article-card:hover {
    transform: scale(1.01); /* Similar to whileHover */
  }
  .article-card:hover .accent-line {
    opacity: 1; /* Fade in accent line */
  }
  .article-card:hover .read-more-arrow {
    transform: translateX(5px); /* Slide arrow */
  }
  .tag-button:hover {
    transform: scale(1.05); /* Similar to whileHover */
  }
</style>

<section class="relative overflow-hidden px-4 py-8">
  <div class="absolute inset-0 opacity-5">
    <div
      class="absolute left-1/4 top-1/4 h-64 w-64 rounded-full bg-[#7aa2f7] blur-3xl"
    >
    </div>
    <div
      class="absolute bottom-1/4 right-1/4 h-48 w-48 rounded-full bg-[#bb9af7] blur-3xl"
    >
    </div>
    <div
      class="absolute left-3/4 top-3/4 h-32 w-32 rounded-full bg-[#9ece6a] blur-3xl"
    >
    </div>
  </div>

  <div class="container relative z-10 mx-auto max-w-6xl">
    <div class="mb-12 text-center">
      <h1
        class="mb-4 bg-gradient-to-r from-[#7aa2f7] via-[#bb9af7] to-[#9ece6a] bg-clip-text text-3xl font-bold text-transparent sm:text-4xl lg:text-5xl"
      >
        Browse by Tags
      </h1>
      <p class="mx-auto max-w-2xl text-sm text-[#a9b1d6] sm:text-lg">
        Discover articles by topic and explore content that interests you most
      </p>

      <div
        class="mx-auto mt-6 h-0.5 w-32 rounded-full bg-gradient-to-r from-transparent via-[#7aa2f7] to-transparent sm:w-48 md:w-64"
      >
      </div>
    </div>

    <div class="mb-12">
      <div
        class="rounded-3xl border border-[#565f89]/30 bg-[#24283b]/60 p-6 shadow-2xl backdrop-blur-xl md:p-8"
      >
        <h2
          class="mb-6 bg-gradient-to-r from-[#c0caf5] to-[#a9b1d6] bg-clip-text text-xl font-semibold text-transparent sm:text-2xl"
        >
          Filter by Tags
        </h2>

        <div class="flex flex-wrap gap-2 sm:gap-3">
          <a
            href={getTagUrl(null)}
            class:list={[
              "tag-button rounded-xl font-semibold transition-all duration-300",
              selectedTag === null
                ? "bg-gradient-to-r from-[#7aa2f7] to-[#bb9af7] text-white shadow-lg shadow-[#7aa2f7]/25"
                : "border border-[#565f89]/40 bg-[#1a1b26]/60 text-[#a9b1d6] hover:border-[#7aa2f7]/50 hover:bg-[#7aa2f7]/10 hover:text-[#c0caf5]",
              "px-3 py-2 text-sm sm:px-4 sm:py-3 sm:text-base",
            ]}
          >
            <span class="flex items-center gap-2">
              <span class="text-lg">#</span>
              <span>All</span>
              {selectedTag === null && <span class="text-sm">‚úì</span>}
            </span>
          </a>

          {
            allTags.map((tag: string) => (
              <a
                href={getTagUrl(tag)}
                class:list={[
                  "tag-button rounded-xl font-semibold transition-all duration-300",
                  selectedTag === tag
                    ? "bg-gradient-to-r from-[#7aa2f7] to-[#bb9af7] text-white shadow-lg shadow-[#7aa2f7]/25"
                    : "border border-[#565f89]/40 bg-[#1a1b26]/60 text-[#a9b1d6] hover:border-[#7aa2f7]/50 hover:bg-[#7aa2f7]/10 hover:text-[#c0caf5]",
                  "px-3 py-2 text-sm sm:px-4 sm:py-3 sm:text-base",
                ]}
              >
                <span class="flex items-center gap-2">
                  <span class="text-lg">#</span>
                  <span>{tag}</span>
                  {selectedTag === tag && <span class="text-sm">‚úì</span>}
                </span>
              </a>
            ))
          }
        </div>

        {
          selectedTag && (
            <div class="mt-6 rounded-xl border border-[#565f89]/30 bg-[#1a1b26]/40 p-4">
              <p class="text-sm text-[#a9b1d6] sm:text-base">
                Showing articles tagged with{" "}
                <span class="font-semibold text-[#7aa2f7]">#{selectedTag}</span>{" "}
                ({paginatedPosts.length} article
                {paginatedPosts.length !== 1 ? "s" : ""} found)
              </p>
            </div>
          )
        }
      </div>
    </div>

    <div>
      <h2
        class="mb-8 bg-gradient-to-r from-[#c0caf5] to-[#a9b1d6] bg-clip-text text-xl font-bold text-transparent sm:text-2xl"
      >
        {selectedTag ? `Articles tagged with #${selectedTag}` : "All Articles"}
      </h2>

      <div class="space-y-4">
        {
          paginatedPosts.length > 0 ? (
            paginatedPosts.map((post: Post) => (
              <div class="group">
                <a
                  href={`/blog/${post.slug}`}
                  class="article-card relative block overflow-hidden rounded-2xl border border-[#565f89]/30 bg-[#24283b]/60 shadow-xl backdrop-blur-xl transition-all duration-500 hover:shadow-2xl hover:shadow-[#7aa2f7]/10"
                >
                  <div class="p-4 sm:p-6">
                    <div class="mb-4 flex items-start justify-between">
                      <div class="flex-1">
                        <h3 class="mb-2 bg-gradient-to-r from-[#c0caf5] to-[#a9b1d6] bg-clip-text text-lg font-bold text-transparent transition-all duration-300 group-hover:from-[#7aa2f7] group-hover:to-[#bb9af7] sm:text-xl">
                          {post.data.title}
                        </h3>

                        <div class="mb-3 flex flex-wrap items-center gap-4">
                          <div class="flex items-center gap-1 text-sm text-[#a9b1d6]">
                            <span class="text-base">üìÖ</span>
                            <span>
                              {new Date(post.data.pubDate).toLocaleDateString()}
                            </span>
                          </div>
                          <div class="flex items-center gap-1 text-sm text-[#a9b1d6]">
                            <span class="text-base">üë§</span>
                            <span>{post.data.authorName}</span>
                          </div>
                          {post.data.tags && (
                            <div class="flex items-center gap-1 text-sm text-[#a9b1d6]">
                              <span class="text-base">üè∑Ô∏è</span>
                              <span>
                                {post.data.tags.length} tag
                                {post.data.tags.length !== 1 ? "s" : ""}
                              </span>
                            </div>
                          )}
                        </div>
                      </div>

                      <div class="read-more-arrow flex items-center gap-2 text-sm font-medium text-[#7aa2f7] transition-colors duration-300 group-hover:text-[#bb9af7]">
                        <span class="hidden sm:block">Read Article</span>
                        <span>‚Üí</span>
                      </div>
                    </div>

                    {post.data.description && (
                      <p class="line-clamp-2 text-sm leading-relaxed text-[#a9b1d6] transition-colors duration-300 group-hover:text-[#c0caf5] sm:line-clamp-3 sm:text-base">
                        {post.data.description}
                      </p>
                    )}

                    {post.data.tags && post.data.tags.length > 0 && (
                      <div class="mt-4 flex flex-wrap gap-2">
                        {post.data.tags.slice(0, 5).map((tag: string) => (
                          <span
                            class:list={[
                              "rounded-lg border border-[#565f89]/40 bg-[#1a1b26]/60 font-medium text-[#a9b1d6] transition-all duration-300 group-hover:border-[#7aa2f7]/50 group-hover:text-[#c0caf5]",
                              selectedTag === tag
                                ? "border-[#7aa2f7]/70 text-[#7aa2f7]"
                                : "",
                              "px-2 py-1 text-xs sm:px-3 sm:py-1 sm:text-sm",
                            ]}
                          >
                            #{tag}
                          </span>
                        ))}
                        {post.data.tags.length > 5 && (
                          <span class="text-xs text-[#a9b1d6] sm:text-sm">
                            +{post.data.tags.length - 5} more
                          </span>
                        )}
                      </div>
                    )}
                  </div>

                  <div class="pointer-events-none absolute inset-0 bg-gradient-to-r from-[#7aa2f7]/5 via-transparent to-[#bb9af7]/5 opacity-0 transition-opacity duration-500 group-hover:opacity-100"></div>

                  <div class="accent-line h-1 bg-gradient-to-r from-[#7aa2f7] via-[#bb9af7] to-[#9ece6a] opacity-0 transition-opacity duration-500 group-hover:opacity-100"></div>
                </a>
              </div>
            ))
          ) : (
            <div class="py-12 text-center">
              <div class="rounded-2xl border border-[#565f89]/30 bg-[#24283b]/50 p-8 shadow-xl backdrop-blur-xl">
                <div class="mb-4 text-6xl">üìù</div>
                <h3 class="mb-2 text-lg font-semibold text-[#c0caf5] sm:text-xl">
                  No articles found
                </h3>
                <p class="text-sm text-[#a9b1d6] sm:text-base">
                  {selectedTag
                    ? `No articles found with the tag "${selectedTag}". Try selecting a different tag.`
                    : "No articles available at the moment."}
                </p>
              </div>
            </div>
          )
        }
      </div>

      {
        totalPages > 1 && (
          <div class="mt-12 flex items-center justify-center">
            <div class="rounded-2xl border border-[#565f89]/30 bg-[#24283b]/50 p-4 shadow-xl backdrop-blur-xl">
              <div class="flex items-center gap-3">
                <a
                  href={getPageUrl(currentPage - 1)}
                  aria-disabled={currentPage === 1}
                  class:list={[
                    "flex items-center gap-2 rounded-xl px-4 py-2 font-semibold transition-all duration-300",
                    currentPage === 1
                      ? "pointer-events-none cursor-not-allowed text-[#565f89]"
                      : "tag-button text-[#a9b1d6] hover:bg-[#1a1b26]/60 hover:text-[#7aa2f7]",
                    "px-3 py-1.5 text-sm sm:text-base",
                  ]}
                >
                  <span>‚Üê</span>
                  <span class="hidden sm:inline">Previous</span>
                </a>

                <div class="text-sm text-[#a9b1d6] sm:text-base">
                  <span class="font-medium text-[#c0caf5]">{currentPage}</span>
                  <span class="mx-2">of</span>
                  <span class="font-medium text-[#c0caf5]">{totalPages}</span>
                </div>

                <a
                  href={getPageUrl(currentPage + 1)}
                  aria-disabled={currentPage === totalPages}
                  class:list={[
                    "flex items-center gap-2 rounded-xl px-4 py-2 font-semibold transition-all duration-300",
                    currentPage === totalPages
                      ? "pointer-events-none cursor-not-allowed text-[#565f89]"
                      : "tag-button text-[#a9b1d6] hover:bg-[#1a1b26]/60 hover:text-[#7aa2f7]",
                    "px-3 py-1.5 text-sm sm:text-base",
                  ]}
                >
                  <span class="hidden sm:inline">Next</span>
                  <span>‚Üí</span>
                </a>
              </div>
            </div>
          </div>
        )
      }
    </div>
  </div>
</section>
