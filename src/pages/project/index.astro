---
import BaseHead from "@astro/base/BaseHead.astro";
import Header from "@astro/header/Header.astro";
import Footer from "@astro/footer/Footer.astro";
import ProjectShowcase from "@astro/projects/ProjectShowcase.astro";
import authorConfig from "@config/siteConfig/info.json";
import { getCollection, type CollectionEntry } from "astro:content";
import { featureFlags } from "@config/featureFlag/featureFlag.json";

const projects = await getCollection("projects");
export const prerender = true;

try {
  if (!featureFlags.showProjects) {
    return Astro.redirect("/access-denied");
  }
} catch (error) {
  return Astro.redirect("/404");
}

const filteredProjects: CollectionEntry<"projects">[] = projects
  .filter((project: CollectionEntry<"projects">) => !project.data.draft)
  .sort((a: CollectionEntry<"projects">, b: CollectionEntry<"projects">) => {
    const rankingA = parseInt(a.data.ProjectRanking || "9999", 10);
    const rankingB = parseInt(b.data.ProjectRanking || "9999", 10);
    return rankingA - rankingB;
  });
---

<html lang="en">
  <head>
    <BaseHead
      title={`Projects | ${authorConfig.SiteName}`}
      description={`Browse all projects on ${authorConfig.SiteName} and explore categorized content.`}
    />
  </head>

  <body
    class="bg-[#1a1b26] text-[#c0caf5]"
    style="overflow-x: hidden; overflow-y: auto;"
  >
    <Header />
    <main class="min-h-screen" style="margin: 0; padding: 0; max-width: 100%;">
      <ProjectShowcase
        projects={filteredProjects}
        title="Project Archive"
        subtitle="A complete index of my builds, experiments, and production-grade launches."
        eyebrow="All Projects"
      />
    </main>

    <Footer />
  </body>
</html>
